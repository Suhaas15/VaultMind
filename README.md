# VaultMind Pro ğŸ¥ğŸ”’

**Secure Medical Intelligence Platform with Zero-Trust Privacy**

VaultMind Pro is a next-generation healthcare application that combines advanced AI analysis with military-grade data privacy. It allows medical professionals to upload patient documents, securely tokenize Personally Identifiable Information (PII) using Skyflow, and generate clinical summaries using Anthropic's Claude AIâ€”all without exposing sensitive data to the AI model.

## ğŸ¯ Core Value Proposition

- **ğŸ”’ Privacy-First**: Patient PII (names, SSNs, DOBs) is tokenized and stored securely in Skyflow Vault
- **ğŸ¤– AI-Powered**: Uses Anthropic's Claude AI to generate professional clinical summaries
- **ğŸ“ˆ Self-Learning**: Continuously improves by learning from doctor feedback and optimizing prompts
- **âš¡ Real-Time**: Live updates via WebSocket connections for instant patient processing status
- **ğŸ›¡ï¸ Zero-Trust Architecture**: AI models never see actual PII data

## ğŸš€ Key Features

-   **Zero-Trust PII Protection**: All sensitive patient data (Name, SSN, DOB, Email) is detected and tokenized *before* storage or processing using **Skyflow Data Privacy Vault**.
-   **Secure AI Analysis**: Clinical summaries are generated by **Anthropic Claude 3.5 Sonnet** using redacted data. The AI never sees the actual PII.
-   **Real-Time Dashboard**: Live updates of patient processing status via WebSockets.
-   **Role-Based Access**: Granular control over who can view decrypted PII (simulated via "Decrypt PII" workflow).
-   **Analytics**: Track processing speed, AI accuracy, and cost efficiency.
-   **Self-Learning System**: Automatically optimizes AI prompts based on doctor feedback.

## ğŸ› ï¸ Tech Stack

-   **Frontend**: React 19, TypeScript, Vite, Tailwind CSS v4, shadcn/ui, Socket.IO Client
-   **Backend**: Python FastAPI, Socket.IO, Celery (for async task processing)
-   **Database**: Sanity.io (Content Lake)
-   **Privacy Vault**: Skyflow (PII Tokenization & Function Invocation)
-   **AI Model**: Anthropic Claude 3.5 Sonnet (via Skyflow Secure Functions or direct fallback)
-   **Infrastructure**: Redis (for Celery task queues and caching)

## ğŸ—ï¸ System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend      â”‚  React + TypeScript + Tailwind CSS
â”‚   (React App)   â”‚  Real-time UI with Socket.IO
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚ HTTP/WebSocket
         â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         Backend API (FastAPI)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  API Routes                           â”‚  â”‚
â”‚  â”‚  - /api/patients (CRUD operations)    â”‚  â”‚
â”‚  â”‚  - /api/feedback (Doctor feedback)    â”‚  â”‚
â”‚  â”‚  - /api/webhooks (External events)    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Services Layer                       â”‚  â”‚
â”‚  â”‚  - AgentService (AI Processing)      â”‚  â”‚
â”‚  â”‚  - SkyflowService (PII Protection)   â”‚  â”‚
â”‚  â”‚  - SanityService (Data Storage)        â”‚  â”‚
â”‚  â”‚  - PromptService (AI Optimization)    â”‚  â”‚
â”‚  â”‚  - MetricsService (Performance)       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         â”‚              â”‚              â”‚
â”Œâ”€â”€â”€â–¼â”€â”€â”€â” â”Œâ”€â”€â–¼â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â–¼â”€â”€â”€â”€â”
â”‚Skyflowâ”‚ â”‚ Sanity  â”‚  â”‚Anthropic â”‚  â”‚ Redis  â”‚
â”‚ Vault â”‚ â”‚  CMS    â”‚  â”‚  Claude  â”‚  â”‚(Celery)â”‚
â”‚       â”‚ â”‚         â”‚  â”‚    AI    â”‚  â”‚        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”§ Component Breakdown

### 1. **Frontend (React + TypeScript)**

**Location**: `frontend/`

**What it does**:
- Provides a modern, responsive web interface for doctors and medical staff
- Displays patient records with encrypted PII (tokens)
- Allows document uploads (TXT, PDF, DOCX)
- Shows real-time processing status via WebSocket
- Enables doctors to provide feedback on AI summaries

**Key Components**:
- `Dashboard.tsx`: Main interface showing patient list and statistics
- `PatientList.tsx`: Scrollable list of all patients
- `TokenViewer.tsx`: Displays patient details with decrypt functionality
- `DocumentUpload.tsx`: Drag-and-drop file upload interface
- `FeedbackDialog.tsx`: Allows doctors to rate AI summaries

**Technologies**:
- React 19.2
- TypeScript
- Tailwind CSS v4
- Socket.IO Client (real-time updates)
- Vite (build tool)

---

### 2. **Backend API (FastAPI)**

**Location**: `backend/`

**What it does**:
- RESTful API server handling all backend operations
- WebSocket server for real-time updates
- Routes HTTP requests to appropriate services
- Manages CORS and authentication

**Key Endpoints**:
- `POST /api/patients/upload`: Upload medical documents
- `GET /api/patients`: List all patients
- `GET /api/patients/{patient_id}`: Get patient details
- `POST /api/patients/{patient_id}/decrypt`: Decrypt PII tokens (with auth)
- `POST /api/feedback`: Submit doctor feedback
- `POST /api/webhooks/sanity`: Webhook endpoint for Sanity.io updates

**Technologies**:
- FastAPI (Python web framework)
- Socket.IO (WebSocket support)
- Uvicorn (ASGI server)

---

### 3. **Skyflow Service** ğŸ”’

**Location**: `backend/services/skyflow_service.py`

**What it does**:
- **PII Protection**: Tokenizes sensitive patient data (names, SSNs, DOBs)
- **PII Detection**: Automatically finds PII in unstructured documents
- **Detokenization**: Securely retrieves original PII when needed (with proper auth)
- **Vault Management**: Stores encrypted PII in Skyflow's secure vault
- **Secure Functions**: Invokes Skyflow Functions for vault-confined AI processing

**Key Functions**:
- `tokenize()`: Converts PII â†’ secure tokens
- `detokenize()`: Converts tokens â†’ original PII (requires auth)
- `detect_pii()`: Finds PII in text using pattern matching
- `invoke_function()`: Calls Skyflow Functions for vault-confined AI processing

**How it works**:
1. When a document is uploaded, Skyflow detects PII (names, SSNs, etc.)
2. PII is sent to Skyflow Vault and replaced with tokens (e.g., `sky_n_abc123`)
3. Only tokens are stored in the database
4. Original PII never leaves Skyflow's secure vault

**Example**:
```
Input:  "Patient Name: John Smith, SSN: 123-45-6789"
Output: "Patient Name: sky_n_abc123, SSN: sky_s_def456"
```

---

### 4. **Sanity Service** ğŸ“Š

**Location**: `backend/services/sanity_service.py`

**What it does**:
- **Data Storage**: Stores patient records in Sanity CMS (headless CMS)
- **Query Interface**: Provides flexible querying of patient data
- **Schema Management**: Manages patient, feedback, and prompt template schemas

**What gets stored**:
- Patient tokens (not actual PII)
- Medical condition, department, priority
- Lab results (non-PII data)
- AI summaries
- Processing metadata (cost, tokens used, duration)
- Doctor feedback

**Why Sanity?**:
- Headless CMS allows flexible data modeling
- Real-time updates
- Easy to query and filter
- Good for structured medical data

**Schema Types**:
- `patient`: Patient records with tokens
- `feedback`: Doctor feedback on AI summaries
- `prompt_template`: AI prompt versions for A/B testing
- `performance_metrics`: System performance tracking

---

### 5. **Agent Service** ğŸ¤–

**Location**: `backend/services/agent_service.py`

**What it does**:
- **AI Processing**: Orchestrates AI clinical summary generation
- **Multi-Strategy**: Tries Skyflow Functions first, falls back to direct Claude API
- **Smart Fallback**: Detokenizes data if needed for AI processing
- **Document Processing**: Uses original document text when available

**Processing Flow**:
1. Receives patient data (with tokens)
2. Selects optimal prompt template (based on performance)
3. **Primary**: Tries Skyflow Function (vault-confined AI processing)
4. **Fallback**: Calls Anthropic Claude API directly
   - Uses original document text if available
   - Or detokenizes patient name for context
5. Generates clinical summary
6. Stores results in Sanity
7. Emits real-time update via WebSocket

**AI Models Used**:
- Claude 3.5 Sonnet (default)
- Configurable via prompt templates

**Output**:
- Professional clinical summary
- Processing metrics (tokens, cost, duration)
- Model version used

---

### 6. **Prompt Service** ğŸ“

**Location**: `backend/services/prompt_service.py`

**What it does**:
- **Prompt Management**: Manages multiple prompt template versions
- **A/B Testing**: Tests different prompts to find best performers
- **Self-Learning**: Automatically selects best-performing prompts based on feedback
- **Optimization**: Tracks which prompts get best ratings from doctors

**Prompt Versions**:
- `v1.0`: Original baseline prompt
- `v2.0`: Enhanced with structured analysis
- `v3.0`: SOAP format (Subjective, Objective, Assessment, Plan)
- `v4.0`: XML-structured with few-shot examples

**Selection Strategy**:
- `best_performing`: Uses highest-rated prompt (default)
- `ab_test`: Randomly selects for A/B testing
- `latest`: Uses newest version

**How it learns**:
1. Doctor rates AI summary (1-5 stars)
2. System tracks which prompt version was used
3. Calculates average rating per prompt
4. Automatically switches to best-performing prompt

---

### 7. **Metrics Service** ğŸ“ˆ

**Location**: `backend/services/metrics_service.py`

**What it does**:
- **Feedback Tracking**: Stores doctor feedback on AI summaries
- **Performance Analysis**: Calculates success rates, average ratings
- **Trend Analysis**: Tracks improvement over time
- **Optimization Recommendations**: Suggests improvements based on data

**Metrics Tracked**:
- Average accuracy rating (1-5 scale)
- Summary quality distribution
- Processing speed trends
- Cost efficiency improvements
- Prompt version performance

**Use Cases**:
- Dashboard statistics
- System improvement tracking
- Cost optimization insights

---

### 8. **Celery Workers** âš™ï¸

**Location**: `backend/workers/tasks.py`

**What it does**:
- **Background Processing**: Handles AI processing asynchronously
- **Queue Management**: Uses Redis to queue patient processing tasks
- **Scalability**: Allows multiple workers to process patients in parallel

**Why Celery?**:
- AI processing can take 5-30 seconds
- Prevents blocking the API
- Allows horizontal scaling
- Falls back to synchronous processing if Redis unavailable

**Task Flow**:
1. Patient uploaded â†’ Task queued
2. Celery worker picks up task
3. Processes patient with AI
4. Updates Sanity
5. Emits WebSocket event

---

## ğŸ”„ Complete Data Flow

### Document Upload Flow

```
1. Doctor uploads document (TXT/PDF/DOCX)
   â†“
2. Backend receives file
   â†“
3. Skyflow detects PII (name, SSN, DOB)
   â†“
4. PII tokenized â†’ stored in Skyflow Vault
   â†“
5. Patient record created in Sanity (with tokens only)
   â†“
6. Processing task queued (Celery) or processed immediately
   â†“
7. Agent Service:
   a. Selects best prompt template
   b. Tries Skyflow Function (vault-confined)
   c. Falls back to Claude API if needed
   â†“
8. AI generates clinical summary
   â†“
9. Summary stored in Sanity
   â†“
10. WebSocket event â†’ Frontend updates in real-time
```

### Decryption Flow (Viewing PII)

```
1. Doctor clicks "Decrypt PII" button
   â†“
2. Frontend calls /api/patients/{id}/decrypt
   â†“
3. Backend retrieves tokens from Sanity
   â†“
4. Skyflow detokenizes (requires auth)
   â†“
5. Original PII returned to frontend
   â†“
6. Displayed in red-highlighted box (visual indicator)
```

### Feedback Loop (Self-Learning)

```
1. Doctor reviews AI summary
   â†“
2. Doctor rates summary (1-5 stars) + optional corrections
   â†“
3. Feedback stored in Sanity
   â†“
4. Metrics Service updates prompt performance
   â†“
5. Prompt Service recalculates best performer
   â†“
6. Future patients use improved prompt automatically
```

---

## ğŸ” Security Architecture

### PII Protection Strategy

1. **Tokenization**: All PII replaced with tokens before storage
2. **Vault Isolation**: Original PII only exists in Skyflow Vault
3. **Access Control**: Detokenization requires proper authentication
4. **Audit Trail**: All access logged (via Skyflow)

### Data Storage Layers

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Sanity CMS (Public Database)      â”‚
â”‚  - Stores: Tokens only             â”‚
â”‚  - No PII                           â”‚
â”‚  - Queryable, searchable            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Skyflow Vault (Secure Vault)       â”‚
â”‚  - Stores: Original PII            â”‚
â”‚  - Encrypted at rest                â”‚
â”‚  - Access-controlled                â”‚
â”‚  - Compliant (HIPAA-ready)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

VaultMind Pro adheres to a **Privacy-by-Design** philosophy:
- **Data Minimization**: Only necessary data is processed
- **Tokenization**: PII is replaced with non-sensitive tokens before storage or AI processing
- **Zero-Trust Architecture**: AI models never see actual PII data
- **Secure Function Invocation**: Primary path uses Skyflow Secure Functions for AI analysis within the vault
- **Audit Logs**: All decryption events are logged

---

## ğŸ Getting Started

### Prerequisites

-   Python 3.10+
-   Node.js 18+
-   Redis (for Celery task queue - will be started automatically by `run.sh`)
-   Skyflow account with Vault ID and credentials
-   Anthropic API key
-   Sanity.io project with API token

### Installation

1.  **Clone the repository**
    ```bash
    git clone <repository-url>
    cd VaultMind
    ```

2.  **Backend Setup**
    ```bash
    cd backend
    python3 -m venv venv
    source venv/bin/activate
    pip install -r requirements.txt
    ```

3.  **Frontend Setup**
    ```bash
    cd ../frontend
    npm install
    ```

4.  **Environment Configuration**
    Create a `.env` file in the root directory with the following variables:
    ```env
    # AI & Privacy
    ANTHROPIC_API_KEY=sk-...
    SKYFLOW_VAULT_ID=...
    SKYFLOW_BEARER_TOKEN=...
    SKYFLOW_APP_NAME=...
    SKYFLOW_KEY_ID=...
    SKYFLOW_PRIVATE_KEY=...
    
    # Database
    SANITY_PROJECT_ID=...
    SANITY_API_TOKEN=...
    SANITY_DATASET=production
    
    # Infrastructure
    REDIS_URL=redis://localhost:6379/0
    ```
    
    **Note**: The `run.sh` script will automatically check and regenerate the Skyflow bearer token if needed using `check_and_regenerate_token.py`.

### Running the Application

We provide a convenience script to start all services (Redis, Celery worker, backend, and frontend):

```bash
chmod +x run.sh
./run.sh
```

This script will:
- Check and regenerate Skyflow bearer token if needed
- Start Redis server (if available)
- Start Celery worker for background task processing
- Start FastAPI backend on port 8000
- Start Vite frontend development server

**Press `Ctrl+C` to stop all services gracefully.**

Alternatively, run them separately:

**Backend:**
```bash
cd backend
source venv/bin/activate
uvicorn backend.main:app --reload --port 8000
```

**Frontend:**
```bash
cd frontend
npm run dev
```

**Celery Worker** (if running separately):
```bash
celery -A backend.workers.tasks:celery_app worker --loglevel=info
```

Access the dashboard at `http://localhost:5173` (or the port shown by Vite).

## ğŸ§ª Testing

Run the comprehensive system test suite:

```bash
python3 backend/tests/test_system.py
```

This verifies:
- Skyflow Mock Tokenization/Detokenization
- PII Detection Logic
- AI Analysis Fallback (using local mock data)
- End-to-End Flow

## ğŸ“ Project Structure

```
VaultMind/
â”œâ”€â”€ backend/              # FastAPI backend application
â”‚   â”œâ”€â”€ api/             # API route handlers
â”‚   â”œâ”€â”€ services/        # Business logic services
â”‚   â”œâ”€â”€ workers/         # Celery task definitions
â”‚   â””â”€â”€ tests/           # Test suite
â”œâ”€â”€ frontend/            # React frontend application
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ components/  # React components
â”‚       â””â”€â”€ lib/        # Utilities and API clients
â”œâ”€â”€ vaultmind-hack/      # Sanity.io CMS configuration
â”‚   â””â”€â”€ schemaTypes/     # Sanity schema definitions
â””â”€â”€ data/                # Sample patient data and test cases
```

## ğŸ”§ Utility Scripts

- `check_and_regenerate_token.py` - Validates and regenerates Skyflow bearer token
- `generate_skyflow_token.py` - Generates a new Skyflow bearer token
- `refresh_skyflow_token.py` - Refreshes an existing Skyflow token
- `create_skyflow_connection.py` - Sets up Skyflow connection configuration

## ğŸ“ API Endpoints

- `POST /api/patients/upload` - Upload patient document for processing
- `GET /api/patients` - List all patients
- `GET /api/patients/{patient_id}` - Get patient details
- `POST /api/patients/{patient_id}/decrypt` - Decrypt PII tokens (simulated)
- `POST /api/feedback` - Submit feedback on AI-generated summaries
- `POST /api/webhooks/sanity` - Webhook endpoint for Sanity.io updates

## ğŸ¯ Use Cases

### 1. **Hospital Admins**
- Upload patient documents in bulk
- Monitor processing status
- View system performance metrics

### 2. **Doctors**
- Review AI-generated clinical summaries
- Provide feedback to improve system
- Access patient records securely

### 3. **Medical Staff**
- Upload individual patient documents
- View patient records (with encrypted PII)
- Track processing status

## ğŸ”® Future Enhancements

- **Multi-language Support**: Process documents in multiple languages
- **Advanced PII Detection**: ML-based detection improvements
- **Custom Prompt Templates**: Allow doctors to create custom prompts
- **Batch Processing**: Process multiple documents simultaneously
- **Export Features**: PDF/CSV export of patient records
- **Analytics Dashboard**: Advanced performance analytics

## ğŸ“Š System Metrics

The system tracks:
- **Processing Speed**: Average time to generate summaries
- **AI Accuracy**: Average doctor ratings (1-5)
- **Cost Efficiency**: Token usage and cost per patient
- **Improvement Trends**: Performance over time

## ğŸš¨ Troubleshooting

**Skyflow Token Issues:**
- Run `python3 check_and_regenerate_token.py` to validate and refresh tokens
- Ensure `SKYFLOW_PRIVATE_KEY` is properly formatted (newlines preserved)

**Redis Connection Errors:**
- Ensure Redis is running: `redis-server` or use the `run.sh` script
- Check `REDIS_URL` in your `.env` file

**Sanity Connection Issues:**
- Verify `SANITY_PROJECT_ID` and `SANITY_API_TOKEN` are correct
- Ensure your Sanity project has the required schema types configured

---

*Built for the Advanced Agentic Coding Hackathon.*
